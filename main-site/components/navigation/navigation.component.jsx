/* eslint-disable @next/next/no-img-element */
import { Fragment, useState, useContext, useEffect } from "react";

import Signinmodal from "../../components/signin-modal/modal.component";
import Signupmodal from "../../components/signup-modal/modal.component";
import Search from "../searchbar/search.component";
import EditUser from "../edit-profile/modal.component";

import { WidthContext } from "../../contexts/screenwidth/screenwidth.context";
import { UserContext } from "../../contexts/user/user.context";

import styles from "./navigation.module.scss";

import Link from "next/link";
import { useRouter } from "next/router";
import { signOut, useSession } from "next-auth/react";

const navResponse = 790;

const Navigation = () => {
  const [isOpen, setIsOpen] = useState(false);
  const screenwidth = useContext(WidthContext);
  const { user } = useContext(UserContext);
  const { status } = useSession();
  const router = useRouter();

  useEffect(() => {
    if (screenwidth > navResponse) {
      setIsOpen(false);
    }
  }, [screenwidth]);

  const HandleLogout = async () => {
    signOut();
  };

  return (
    <Fragment>
      <div className={styles["navigation"]}>
        <Link href="/">
          <a className={styles["logo-container"]}>
            <img alt="loading" src="/Logo/Logo-final.svg" />
          </a>
        </Link>

        {screenwidth < navResponse && (
          <Search
            style={{
              position: "absolute",
              right: "10px",
              top: "24px",
              margin: "0 1rem 0 0",
              display: "initial",
            }}
          />
        )}
        <div className={styles["nav-links-container-background"]}>
          <div
            className={styles["nav-links-container"]}
            style={!isOpen && screenwidth < navResponse ? { display: "none" } : { display: "flex" }}
            open={isOpen}
          >
            <Link href="/">
              <a
                className={
                  router.pathname === "/"
                    ? styles["active"] + " " + styles["nav-link"]
                    : styles["nav-link"]
                }
              >
                <svg
                  width="21"
                  height="20"
                  viewBox="0 0 21 20"
                  fill="none"
                  xmlns="http://www.w3.org/2000/svg"
                >
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M10.5082 1.11365C10.7935 1.03642 11.0941 1.03642 11.3794 1.11365C11.7105 1.20331 11.9893 1.42219 12.2118 1.59688C12.2331 1.61356 12.2538 1.62984 12.274 1.64556L17.9259 6.0415C17.9477 6.05841 17.9693 6.07517 17.9907 6.09178C18.3045 6.33535 18.581 6.54994 18.7871 6.82853C18.9679 7.07301 19.1026 7.34844 19.1846 7.64127C19.278 7.97495 19.2776 8.32496 19.2772 8.72225C19.2772 8.74935 19.2771 8.77668 19.2771 8.80423V14.8655C19.2771 15.3048 19.2772 15.6837 19.2517 15.9959C19.2247 16.3253 19.1653 16.653 19.0047 16.9683C18.765 17.4387 18.3825 17.8212 17.9121 18.0609C17.5968 18.2215 17.2691 18.281 16.9397 18.3079C16.6275 18.3334 16.2486 18.3334 15.8093 18.3333H6.07833C5.63905 18.3334 5.26008 18.3334 4.94794 18.3079C4.61849 18.281 4.29081 18.2215 3.97549 18.0609C3.50509 17.8212 3.12263 17.4387 2.88295 16.9683C2.72229 16.653 2.66286 16.3253 2.63594 15.9959C2.61044 15.6837 2.61045 15.3048 2.61047 14.8655L2.61047 8.80423C2.61047 8.77668 2.61044 8.74935 2.61041 8.72224C2.60998 8.32496 2.6096 7.97495 2.703 7.64127C2.78497 7.34844 2.91967 7.07301 3.1005 6.82853C3.30655 6.54994 3.58306 6.33536 3.89692 6.09179C3.91834 6.07517 3.93992 6.05842 3.96168 6.0415L9.6136 1.64556C9.63381 1.62984 9.65454 1.61356 9.67579 1.59688C9.89829 1.42219 10.1771 1.20331 10.5082 1.11365Z"
                  />
                </svg>
                <span>Home</span>
              </a>
            </Link>
            <Link href="/scripts">
              <a
                className={
                  router.pathname === "/scripts"
                    ? styles["active"] + " " + styles["nav-link"]
                    : styles["nav-link"]
                }
              >
                <svg width="21" height="20" viewBox="0 0 21 20" xmlns="http://www.w3.org/2000/svg">
                  <path
                    fillRule="evenodd"
                    clipRule="evenodd"
                    d="M11.7757 1.6269C11.7767 1.64678 11.7767 1.65774 11.7767 1.67966L11.7767 5.35993C11.7767 5.57025 11.7766 5.77508 11.7908 5.94854C11.8064 6.13904 11.8431 6.36382 11.9584 6.59C12.1181 6.90361 12.3731 7.15857 12.6867 7.31836C12.9129 7.43361 13.1377 7.47033 13.3282 7.4859C13.5016 7.50007 13.7065 7.50005 13.9168 7.50002L17.5971 7.50002C17.619 7.50002 17.6299 7.50002 17.6497 7.50097C18.0613 7.5206 18.423 7.8825 18.4424 8.29403C18.4434 8.31388 18.4434 8.32035 18.4434 8.33329V14.3678C18.4434 15.0386 18.4434 15.5922 18.4065 16.0432C18.3683 16.5116 18.2861 16.9422 18.08 17.3466C17.7605 17.9739 17.2505 18.4838 16.6233 18.8034C16.2189 19.0094 15.7883 19.0916 15.3199 19.1299C14.8689 19.1667 14.3153 19.1667 13.6445 19.1667H8.24226C7.57146 19.1667 7.01783 19.1667 6.56684 19.1299C6.09842 19.0916 5.66784 19.0094 5.26339 18.8034C4.63619 18.4838 4.12625 17.9739 3.80667 17.3466C3.6006 16.9422 3.51846 16.5116 3.48019 16.0432C3.44334 15.5922 3.44335 15.0386 3.44336 14.3678V5.63225C3.44335 4.96145 3.44334 4.40781 3.48019 3.95682C3.51846 3.48841 3.6006 3.05782 3.80667 2.65338C4.12625 2.02617 4.63619 1.51624 5.26339 1.19666C5.66784 0.990582 6.09842 0.908445 6.56684 0.870174C7.01783 0.833327 7.57145 0.833335 8.24224 0.833344H10.9434C10.9564 0.833339 10.9629 0.833336 10.9827 0.834276C11.3942 0.853743 11.7561 1.21542 11.7757 1.6269Z"
                  />
                  <path d="M17.1672 5.7719C17.067 5.83334 16.9447 5.83334 16.7 5.83334L14.11 5.8333C13.8767 5.8333 13.76 5.8333 13.6709 5.78788C13.5925 5.74794 13.5287 5.68419 13.4888 5.60579C13.4434 5.51666 13.4434 5.39999 13.4434 5.16665L13.4434 2.57671C13.4434 2.33202 13.4434 2.20968 13.5048 2.10946C13.5916 1.96793 13.796 1.88331 13.9574 1.92211C14.0717 1.94959 14.1514 2.02937 14.3108 2.18894L17.0878 4.96587C17.2473 5.12528 17.3271 5.20499 17.3546 5.31929C17.3934 5.48071 17.3088 5.68513 17.1672 5.7719Z" />
                </svg>
                <span>Scripts</span>
              </a>
            </Link>
            <a
              className={styles["nav-link"] + " " + styles["nav-link2"]}
              href="https://discord.gg/9N6FWkshpk"
              target="_blank"
              rel="noreferrer"
            >
              <svg width="21" height="20" viewBox="0 0 21 20" xmlns="http://www.w3.org/2000/svg">
                <g clipPath="url(#clip0_456_67679)">
                  <path d="M17.8746 3.74333C16.5996 3.16833 15.2329 2.74333 13.8038 2.50167C13.791 2.49922 13.7779 2.5008 13.7661 2.50617C13.7543 2.51155 13.7444 2.52046 13.7379 2.53167C13.5629 2.83917 13.3679 3.24 13.2313 3.55667C11.7155 3.3302 10.1745 3.3302 8.65876 3.55667C8.50654 3.20572 8.33488 2.86352 8.14459 2.53167C8.13814 2.52032 8.12839 2.51121 8.11662 2.50555C8.10486 2.49989 8.09165 2.49795 8.07876 2.5C6.65043 2.74166 5.28376 3.16667 4.00793 3.7425C3.99695 3.7471 3.98765 3.75495 3.98126 3.765C1.38793 7.5775 0.677093 11.2958 1.02626 14.9675C1.02723 14.9765 1.03002 14.9852 1.03446 14.9931C1.03891 15.001 1.0449 15.0078 1.05209 15.0133C2.56575 16.1154 4.25404 16.9548 6.04626 17.4967C6.05875 17.5005 6.07212 17.5005 6.0846 17.4966C6.09709 17.4928 6.10812 17.4852 6.11626 17.475C6.50192 16.9592 6.84367 16.412 7.13793 15.8392C7.14201 15.8313 7.14436 15.8227 7.14483 15.8139C7.14529 15.8051 7.14386 15.7963 7.14062 15.788C7.13738 15.7798 7.13241 15.7724 7.12605 15.7663C7.11969 15.7601 7.11209 15.7554 7.10376 15.7525C6.56543 15.5498 6.04383 15.3051 5.54376 15.0208C5.53477 15.0157 5.5272 15.0084 5.52172 14.9996C5.51625 14.9909 5.51303 14.9809 5.51237 14.9705C5.51171 14.9602 5.51362 14.9499 5.51794 14.9405C5.52225 14.9311 5.52883 14.9229 5.53709 14.9167C5.64209 14.8392 5.74709 14.7583 5.84709 14.6775C5.85609 14.6702 5.86694 14.6656 5.87841 14.6641C5.88989 14.6627 5.90155 14.6644 5.91209 14.6692C9.18459 16.1392 12.7288 16.1392 15.9629 14.6692C15.9735 14.6641 15.9853 14.6621 15.9969 14.6635C16.0086 14.6648 16.0196 14.6694 16.0288 14.6767C16.1288 14.7583 16.2329 14.8392 16.3388 14.9167C16.3471 14.9228 16.3538 14.9308 16.3582 14.9402C16.3627 14.9495 16.3648 14.9598 16.3643 14.9701C16.3638 14.9804 16.3607 14.9904 16.3554 14.9993C16.3501 15.0082 16.3426 15.0156 16.3338 15.0208C15.8354 15.3075 15.3171 15.55 14.7729 15.7517C14.7646 15.7547 14.757 15.7595 14.7506 15.7657C14.7442 15.7719 14.7393 15.7794 14.736 15.7877C14.7328 15.796 14.7314 15.8048 14.7318 15.8137C14.7323 15.8226 14.7347 15.8313 14.7388 15.8392C15.0388 16.4117 15.3821 16.9567 15.7596 17.4742C15.7674 17.4848 15.7784 17.4927 15.7909 17.4969C15.8034 17.5011 15.8169 17.5013 15.8296 17.4975C17.6249 16.9572 19.3159 16.1173 20.8313 15.0133C20.8387 15.0082 20.8449 15.0015 20.8495 14.9937C20.8541 14.986 20.8569 14.9773 20.8579 14.9683C21.2746 10.7233 20.1596 7.035 17.9004 3.76666C17.8949 3.75604 17.8857 3.74776 17.8746 3.74333ZM7.62709 12.7317C6.64209 12.7317 5.82959 11.8408 5.82959 10.7483C5.82959 9.655 6.62626 8.765 7.62709 8.765C8.63543 8.765 9.44043 9.6625 9.42459 10.7483C9.42459 11.8417 8.62793 12.7317 7.62709 12.7317ZM14.2729 12.7317C13.2871 12.7317 12.4754 11.8408 12.4754 10.7483C12.4754 9.655 13.2713 8.765 14.2729 8.765C15.2813 8.765 16.0863 9.6625 16.0704 10.7483C16.0704 11.8417 15.2821 12.7317 14.2729 12.7317Z" />
                </g>
                <defs>
                  <clipPath id="clip0_456_67679">
                    <rect width="20" height="20" transform="translate(0.943359)" />
                  </clipPath>
                </defs>
              </svg>
              <span>Discord</span>
            </a>
            <a
              className={styles["nav-link"] + " " + styles["nav-link2"]}
              href="https://www.youtube.com/channel/UC2_Ab-9puBiqcQGcwoz6Rag"
              target="_blank"
              rel="noreferrer"
            >
              <svg width="21" height="20" viewBox="0 0 21 20" xmlns="http://www.w3.org/2000/svg">
                <path
                  fillRule="evenodd"
                  clipRule="evenodd"
                  d="M11.0095 3.33837C10.8727 3.33703 10.7489 3.33606 10.6411 3.33534C10.622 3.33404 10.6027 3.33337 10.5833 3.33337L9.75 3.33337C9.72959 3.33337 9.70936 3.33411 9.68932 3.33555C9.58194 3.33633 9.45897 3.3374 9.32308 3.33885C8.8107 3.34431 8.11296 3.35523 7.37321 3.37713C6.6348 3.39899 5.84786 3.43197 5.15909 3.48201C4.49355 3.53037 3.84915 3.59888 3.43732 3.70859L3.4258 3.71175C2.92853 3.8519 2.47683 4.12039 2.11648 4.49046C1.75611 4.86056 1.49988 5.31914 1.37402 5.82004C1.36948 5.83811 1.36555 5.85633 1.36223 5.87467C1.11493 7.24072 0.993823 8.62649 1.00042 10.0146C0.991895 11.4131 1.11301 12.8095 1.36223 14.1858C1.36715 14.213 1.37341 14.2399 1.381 14.2664C1.51974 14.7517 1.78169 15.1928 2.1412 15.5473C2.50068 15.9017 2.94556 16.1575 3.4327 16.2903L3.43732 16.2915C3.84915 16.4012 4.49355 16.4697 5.15909 16.5181C5.84786 16.5681 6.6348 16.6011 7.37321 16.623C8.11296 16.6448 8.8107 16.6558 9.32308 16.6612C9.45897 16.6627 9.58194 16.6637 9.68933 16.6645C9.70936 16.666 9.7296 16.6667 9.75 16.6667H10.5833C10.6037 16.6667 10.624 16.666 10.644 16.6645C10.7514 16.6637 10.8744 16.6627 11.0103 16.6612C11.5226 16.6558 12.2204 16.6448 12.9601 16.623C13.6985 16.6011 14.4855 16.5681 15.1742 16.5181C15.8398 16.4697 16.4842 16.4012 16.896 16.2915L16.9075 16.2883C17.4048 16.1482 17.8565 15.8797 18.2169 15.5096C18.5772 15.1395 18.8335 14.6809 18.9593 14.18C18.9639 14.162 18.9678 14.1437 18.9711 14.1254C19.2165 12.7694 19.3376 11.3941 19.3329 10.0163C19.3415 8.61752 19.2204 7.22098 18.9711 5.84445C18.9678 5.82612 18.9639 5.80792 18.9593 5.78986C18.8335 5.28896 18.5772 4.83037 18.2169 4.46028C17.8565 4.0902 17.4048 3.82171 16.9075 3.68157C16.8979 3.67885 16.8882 3.6763 16.8784 3.67393C16.4732 3.57536 15.8348 3.51309 15.169 3.46891C14.4817 3.42332 13.6959 3.39324 12.958 3.3733C12.2188 3.35332 11.5216 3.34335 11.0095 3.33837ZM8.37478 7.18011C8.29167 7.29113 8.29167 7.49 8.29167 7.88774V12.1122C8.29167 12.5099 8.29167 12.7088 8.37478 12.8198C8.44722 12.9166 8.55809 12.9771 8.67865 12.9857C8.81699 12.9956 8.98427 12.8881 9.31884 12.673L12.6045 10.5607C12.8948 10.3741 13.04 10.2808 13.0901 10.1621C13.1339 10.0585 13.1339 9.94147 13.0901 9.83779C13.04 9.71913 12.8948 9.62581 12.6045 9.43918L9.31884 7.32695C8.98427 7.11187 8.81699 7.00433 8.67865 7.01421C8.55809 7.02283 8.44722 7.08336 8.37478 7.18011Z"
                />
              </svg>
              <span>Youtube</span>
            </a>
            {screenwidth > 1400 && (
              <Link href="/admin">
                <a className={styles["nav-link"]}>
                  <img src="/Nav-Icon/script-nav.svg" alt="script-icon" />
                  <span>Admin</span>
                </a>
              </Link>
            )}
            <div className={styles["nav-button-container"]}>
              <Search />
              <div className={styles["nav-button-separator"]}>
                <img src="/Nav-Icon/nav-seperator.svg" alt="" />
              </div>
              {status !== "unauthenticated" ? (
                <NavUserIcon user={user} logout={HandleLogout} />
              ) : (
                <>
                  <Signinmodal className={styles["nav-b1"]}>Log In</Signinmodal>{" "}
                  <Signupmodal className={styles["nav-b2"]}>Join Community</Signupmodal>
                </>
              )}
            </div>
          </div>
        </div>
        <button
          className={styles["nav-toggle"]}
          onClick={() => {
            setIsOpen(!isOpen);
          }}
        >
          <img src="/Nav-Icon/menu.svg" alt="hamburger-menu" />
        </button>
      </div>
    </Fragment>
  );
};

export default Navigation;

function NavUserIcon({ user, logout }) {
  const [isOpen, SetisOpen] = useState(false);
  return (
    <div className={styles["nui"]}>
      <div
        className={styles["nui-icon"]}
        onClick={() => {
          SetisOpen(!isOpen);
        }}
      >
        <img alt="" src="/Script/Avatars/avatar.png" />
      </div>

      {isOpen && (
        <div className={styles["nui-dropdown"]}>
          <div className={styles["nui-header"]}>
            <div className={styles["nui-header-inner"]}>
              <img alt="" src="/Script/Avatars/avatar.png" />
              <div className={styles["nui-details"]}>
                <p className={styles["nui-p1"]}>{user.name}</p>
                <p className={styles["nui-p2"]}>{user.email}</p>
              </div>
            </div>
          </div>
          <EditUser className={styles["nui-dropdown-row"]}>
            <img alt="" src="/Nav-Icon/user-icon.svg" />
            <p>Edit profile</p>
          </EditUser>
          <button className={styles["nui-dropdown-row"]} onClick={logout}>
            <img alt="" src="/Nav-Icon/logout-icon.svg" />
            <p>Log out</p>
          </button>
        </div>
      )}
    </div>
  );
}
